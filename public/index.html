<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>LOOKLI - ××•×¦××™× ××ª ×”×œ×•×§ ×©×œ×š</title>
  <style>
    :root{
      --bg:#fff;
      --card:#fff;
      --text:#787878;
      --muted:#787878;
      --accent:#e0a1c0;
      --accent-light:#787878;
      --accent-dark:#e0a1c0;
      --border:#fff;
      --radius:4px;
      --shadow:0 4px 20px rgba(0,0,0,.08);
      --shadow2:0 8px 40px rgba(0,0,0,.12);
      --container:1600px;
      --sidebar:280px;
      --header-gradient:linear-gradient(135deg,#d191b0 50%,#c48cb3 100%);
      --sale-color:#ef4444
    }
    *{box-sizing:border-box;font-family:'Segoe UI',system-ui,-apple-system,sans-serif}
    body{margin:0;background:var(--bg);color:var(--text)}
    a{color:inherit;text-decoration:none}
    
    /* ===== HEADER ===== */
    .header{background:var(--header-gradient);padding:0;position:sticky;top:0;z-index:100;box-shadow:0 4px 30px rgba(102,126,234,.3)}
    .header-top{max-width:var(--container);margin:0 auto;padding:14px 24px;display:flex;align-items:center;justify-content:space-between}
    .logo{display:flex;align-items:center;gap:14px;text-decoration:none}
    .logo img{height:48px;width:auto}
    .header-nav{display:flex;gap:20px}
    .header-nav a{color:#fff;font-weight:600;font-size:14px;text-decoration:none;padding:8px 16px;border-radius:8px;transition:background .2s}
    .header-nav a:hover{background:rgba(255,255,255,.2)}
    
    /* Active Filters Bar */
    .active-filters-bar{display:none;background:#fff;border-bottom:1px solid var(--border);padding:10px 24px}
    .active-filters-bar.show{display:block}
    .active-filters-inner{max-width:var(--container);margin:0 auto;display:flex;align-items:center;gap:12px;flex-wrap:wrap}
    .active-filters-label{font-weight:700;font-size:13px;color:var(--muted)}
    .active-filters-tags{display:flex;gap:8px;flex-wrap:wrap}
    .filter-tag{display:flex;align-items:center;gap:6px;background:var(--accent);color:#fff;padding:6px 12px;border-radius:20px;font-size:12px;font-weight:600}
    .filter-tag .remove-tag{cursor:pointer;font-size:14px;opacity:.8}
    .filter-tag .remove-tag:hover{opacity:1}
    .clear-all-btn{background:none;border:2px solid var(--border);padding:6px 14px;border-radius:20px;font-size:12px;font-weight:600;color:var(--muted);cursor:pointer;transition:all .15s}
    .clear-all-btn:hover{border-color:var(--accent);color:var(--accent)}
    
    /* Search Bar */
    .search-section{background:rgba(255,255,255,.1);backdrop-filter:blur(10px);border-top:1px solid rgba(255,255,255,.1)}
    .search-inner{max-width:var(--container);margin:0 auto;padding:12px 24px}
    .searchbar{display:flex;gap:12px;background:#fff;border-radius:14px;padding:6px;box-shadow:var(--shadow2)}
    .searchbar input{flex:1;border:0;outline:none;font-size:16px;padding:12px 18px;background:transparent;font-weight:500}
    .searchbar input::placeholder{color:#9ca3af}
    .searchbar .btn{border:none;cursor:pointer;padding:14px 20px;border-radius:10px;background:var(--accent);transition:all .2s;display:flex;align-items:center;justify-content:center}
    .searchbar .btn:hover{background:var(--accent-dark);transform:translateY(-2px)}
    .searchbar .btn svg{width:24px;height:24px;color:#fff}
    
    /* AI Analysis Box */
    .ai-analysis{max-width:var(--container);margin:0 auto;padding:14px 24px;display:none}
    .ai-analysis.active{display:block}
    .ai-box{background:linear-gradient(135deg,rgba(79,70,229,.08),rgba(168,85,247,.08));border:2px solid rgba(79,70,229,.2);border-radius:12px;padding:14px 18px;font-size:14px;font-weight:600;display:flex;align-items:center;gap:12px}
    .ai-box .ai-icon{width:34px;height:34px;background:var(--accent);border-radius:8px;display:flex;align-items:center;justify-content:center;color:#fff;font-size:16px}
    
    /* ===== MAIN LAYOUT ===== */
    .wrap{display:flex;gap:0;min-height:calc(100vh - 140px)}
    @media(max-width:1000px){.wrap{flex-direction:column}.filters{display:none}}
    
    /* ===== SIDEBAR ===== */
    .filters{width:var(--sidebar);background:#fff;border-left:1px solid var(--border);padding:0;flex-shrink:0;overflow-y:auto;height:calc(100vh - 136px);position:sticky;top:136px}
    .filters::-webkit-scrollbar{width:5px}
    .filters::-webkit-scrollbar-track{background:#f3f4f6}
    .filters::-webkit-scrollbar-thumb{background:var(--accent-light);border-radius:3px}
    
    /* Filter Accordion */
    .filter-section{border-bottom:1px solid var(--border)}
    .filter-header{display:flex;justify-content:space-between;align-items:center;padding:18px 20px;cursor:pointer;font-weight:700;font-size:15px;color:var(--text);transition:background .15s}
    .filter-header:hover{background:#f9fafb}
    .filter-header .arrow{transition:transform .2s;color:var(--muted);font-size:12px}
    .filter-section.open .filter-header .arrow{transform:rotate(180deg)}
    .filter-content{display:none;padding:0 20px 18px}
    .filter-section.open .filter-content{display:block}
    
    /* Filter Options */
    .filter-options{display:flex;flex-wrap:wrap;gap:8px}
    .filter-opt{padding:10px 16px;border:2px solid var(--border);border-radius:8px;background:#fff;cursor:pointer;font-weight:700;font-size:14px;transition:all .15s;color:var(--muted)}
    .filter-opt:hover{border-color:var(--accent-light);color:var(--accent)}
    .filter-opt.active{background:var(--accent);color:#fff;border-color:var(--accent)}
    
    /* Store logos */
    .store-opts{display:flex;gap:10px;flex-wrap:wrap}
    .store-opt{width:65px;height:65px;border:2px solid var(--border);border-radius:12px;background:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .15s;overflow:hidden}
    .store-opt:hover{border-color:var(--accent-light)}
    .store-opt.active{border-color:var(--accent);box-shadow:0 0 0 3px rgba(144,97,249,.2)}
    .store-opt img{max-width:85%;max-height:85%;object-fit:contain}
    .store-opt span{font-size:12px;font-weight:800}
    
    /* Color options */
    .color-opts{display:flex;flex-wrap:wrap;gap:10px}
    .color-opt{width:34px;height:34px;border-radius:50%;border:3px solid #ddd;cursor:pointer;transition:all .15s;box-shadow:0 2px 4px rgba(0,0,0,.15)}
    .color-opt:hover{transform:scale(1.1)}
    .color-opt.active{border-color:var(--accent);box-shadow:0 0 0 3px rgba(144,97,249,.3)}
    
    /* Size options */
    .size-opts{display:flex;flex-wrap:wrap;gap:8px}
    .size-opt{min-width:48px;padding:10px 14px;border:2px solid var(--border);border-radius:8px;background:#fff;cursor:pointer;font-weight:700;font-size:14px;text-align:center;transition:all .15s}
    .size-opt:hover{border-color:var(--accent-light)}
    .size-opt.active{background:var(--accent);color:#fff;border-color:var(--accent)}
    
    /* Price slider */
    .price-section{padding:10px 0}
    .price-display{font-size:16px;font-weight:800;color:var(--accent);text-align:center;margin-bottom:12px}
    .price-slider input[type="range"]{width:100%;height:6px;border-radius:3px;background:linear-gradient(to left,var(--accent),var(--accent-light));outline:none;-webkit-appearance:none;cursor:pointer}
    .price-slider input[type="range"]::-webkit-slider-thumb{-webkit-appearance:none;width:22px;height:22px;border-radius:50%;background:#fff;border:3px solid var(--accent);cursor:pointer;box-shadow:0 2px 6px rgba(144,97,249,.3)}
    
    /* Reset button */
    .reset-btn{width:100%;padding:14px;margin-top:10px;border:2px solid var(--border);border-radius:10px;background:#fff;cursor:pointer;font-weight:700;font-size:14px;color:var(--muted);transition:all .15s}
    .reset-btn:hover{border-color:var(--accent);color:var(--accent)}
    
    /* ===== MOBILE STYLES ===== */
    @media(max-width:768px){
      .header-top{padding:10px 16px}
      .logo img{height:36px}
      .header-nav{display:none}
      .search-inner{padding:10px 16px}
      .searchbar{padding:4px;border-radius:10px}
      .searchbar input{font-size:14px;padding:10px 12px}
      .searchbar .btn{padding:10px 14px;border-radius:8px}
      .searchbar .btn svg{width:20px;height:20px}
      
      .active-filters-bar{padding:8px 16px}
      .active-filters-inner{gap:8px}
      .active-filters-label{font-size:12px}
      .filter-tag{padding:5px 10px;font-size:11px}
      
      .wrap{flex-direction:column}
      .filters{display:none;position:fixed;top:0;right:0;width:85%;max-width:320px;height:100vh;z-index:200;background:#fff;transform:translateX(100%);transition:transform .3s ease}
      .filters.open{display:block;transform:translateX(0)}
      
      /* Mobile Sidebar Design */
      .filter-section{border-bottom:1px solid #eee}
      .filter-header{padding:16px 20px;font-size:14px}
      .filter-content{padding:0 16px 16px}
      .filter-opt{padding:8px 14px;font-size:13px;border-radius:6px}
      .color-opt{width:30px;height:30px}
      .size-opt{min-width:42px;padding:8px 12px;font-size:12px}
      .store-opt{width:55px;height:55px;border-radius:8px}
      
      .mobile-filter-btn{display:flex !important;position:fixed;bottom:80px;right:16px;width:50px;height:50px;background:var(--accent);border-radius:50%;align-items:center;justify-content:center;box-shadow:0 4px 15px rgba(224,161,192,.4);z-index:149;color:#fff;font-size:20px;border:none;cursor:pointer}
      
      .mobile-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:199}
      .mobile-overlay.show{display:block}
      
      .main{padding:16px}
      .toolbar{margin-bottom:12px}
      .meta{font-size:13px}
      
      .grid{grid-template-columns:repeat(2,1fr);gap:10px}
      .card{border-radius:4px}
      .card-body{padding:10px}
      .title{font-size:12px;min-height:32px}
      .price{font-size:14px}
      .price-original{font-size:11px}
      .store{font-size:10px}
      .card-footer{margin-top:6px}
      .sizes{font-size:9px}
      .shipping-badge{font-size:8px;padding:3px 6px}
      .sale-badge{font-size:9px;padding:4px 8px;top:6px;left:6px;border-radius:2px}
      .card-logo{width:32px;height:32px;top:6px;right:6px;border-radius:4px}
      .card-colors{padding:3px 5px;bottom:6px;right:6px;border-radius:4px}
      .card-color{width:12px;height:12px}
      .img-wrap{border-radius:4px 4px 0 0}
      
      .ads-sidebar{display:none !important}
      
      .whatsapp-btn{bottom:16px;right:16px;width:50px;height:50px}
      .whatsapp-btn svg{width:24px;height:24px}
      
      .modal{width:100%;max-height:100vh;border-radius:0}
      .modal-body{grid-template-columns:1fr;padding:12px 16px}
      .modal-head{padding:14px 16px}
      .modal-title{font-size:15px}
    }
    
    @media(max-width:400px){
      .grid{gap:8px}
      .card-body{padding:8px}
      .title{font-size:11px}
      .price{font-size:13px}
    }
    
    .mobile-filter-btn{display:none}
    
    /* Mobile Menu Button */
    .mobile-menu-btn{display:none;background:none;border:none;color:#fff;font-size:28px;cursor:pointer;padding:8px}
    @media(max-width:768px){
      .mobile-menu-btn{display:block}
    }
    
    /* Filter close button */
    .filter-close-btn{display:none;position:absolute;top:12px;left:12px;width:36px;height:36px;background:#fff;border:1px solid #eee;border-radius:50%;font-size:18px;cursor:pointer;z-index:10}
    @media(max-width:768px){
      .filter-close-btn{display:flex;align-items:center;justify-content:center}
      .filters{position:relative}
    }
    .main{flex:1;padding:20px 24px;min-height:60vh}
    .toolbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}
    .meta{color:var(--muted);font-size:14px;font-weight:700}
    
    /* Ads area */
    .ads-sidebar{width:180px;flex-shrink:0;padding:20px 12px;display:none}
    @media(min-width:1300px){.ads-sidebar{display:block}}
    .ad-placeholder{background:#f0f0f0;border:2px dashed #ccc;border-radius:12px;height:600px;display:flex;align-items:center;justify-content:center;color:#999;font-size:13px;text-align:center}
    
    /* Product Grid - 4 columns */
    .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:18px}
    @media(max-width:1200px){.grid{grid-template-columns:repeat(3,1fr)}}
    @media(max-width:900px){.grid{grid-template-columns:repeat(2,1fr)}}
    @media(max-width:500px){.grid{grid-template-columns:1fr}}
    
    /* Product Card */
    .card{background:var(--card);border-radius:var(--radius);overflow:hidden;box-shadow:var(--shadow);cursor:pointer;transition:transform .2s,box-shadow .2s}
    .card:hover{transform:translateY(-4px);box-shadow:var(--shadow2)}
    .img-wrap{position:relative;width:100%;aspect-ratio:3/4;background:#f3f4f6;overflow:hidden}
    
    /* SALE Badge */
    .sale-badge{position:absolute;top:10px;left:10px;background:var(--sale-color);color:#fff;padding:6px 10px;border-radius:6px;font-size:11px;font-weight:800;z-index:5;box-shadow:0 3px 10px rgba(239,68,68,.3)}
    
    /* Carousel */
    .carousel{position:relative;width:100%;height:100%}
    .carousel-inner{display:flex;height:100%;transition:transform .3s ease}
    .carousel-slide{min-width:100%;height:100%}
    .carousel-slide img{width:100%;height:100%;object-fit:cover}
    .carousel-dots{position:absolute;bottom:10px;left:50%;transform:translateX(-50%);display:flex;gap:5px}
    .carousel-dot{width:7px;height:7px;border-radius:50%;background:rgba(255,255,255,.5);cursor:pointer;border:1px solid rgba(0,0,0,.2)}
    .carousel-dot.active{background:#fff}
    .carousel-nav{position:absolute;top:50%;transform:translateY(-50%);width:28px;height:28px;background:rgba(255,255,255,.9);border:none;border-radius:50%;cursor:pointer;font-size:14px;font-weight:bold;display:none;align-items:center;justify-content:center;box-shadow:0 2px 6px rgba(0,0,0,.15);color:#333}
    .img-wrap:hover .carousel-nav{display:flex}
    .carousel-prev{right:8px}
    .carousel-next{left:8px}
    
    /* Card elements */
    .card-logo{position:absolute;top:10px;right:10px;width:42px;height:42px;display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,.9);border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,.1)}
    .card-logo img{max-width:90%;max-height:90%;object-fit:contain}
    .card-colors{position:absolute;bottom:10px;right:10px;display:flex;gap:4px;background:rgba(255,255,255,.95);padding:5px 8px;border-radius:16px;box-shadow:0 2px 6px rgba(0,0,0,.1)}
    .card-color{width:16px;height:16px;border-radius:50%;border:2px solid #fff;box-shadow:0 1px 3px rgba(0,0,0,.2)}
    .card-color-more{font-size:10px;font-weight:800;color:#666;padding:0 3px;display:flex;align-items:center}
    
    .card-body{padding:14px}
    .title{font-size:14px;font-weight:700;line-height:1.4;overflow:hidden;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;min-height:40px;color:var(--text)}
    .subrow{display:flex;justify-content:space-between;align-items:center;margin-top:8px}
    .price-wrap{display:flex;align-items:center;gap:6px}
    .price{font-weight:900;font-size:17px}
    .price-original{font-size:13px;color:var(--muted);text-decoration:line-through}
    .price.sale{color:var(--sale-color)}
    .store{font-size:12px;color:var(--muted);font-weight:600}
    .card-footer{display:flex;justify-content:space-between;align-items:center;margin-top:8px;gap:6px}
    .sizes{font-size:11px;color:var(--muted);font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .shipping-badge{font-size:10px;font-weight:700;padding:4px 8px;border-radius:5px;white-space:nowrap;color:var(--accent);background:rgba(144,97,249,.1)}
    .shipping-badge.free{color:#16a34a;background:#dcfce7}
    
    .empty{padding:50px;text-align:center;color:var(--muted);border:2px dashed var(--border);border-radius:var(--radius);background:#fff;font-weight:700;font-size:15px}
    
    /* ===== MODAL ===== */
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;z-index:200;padding:20px;overflow:auto;backdrop-filter:blur(4px)}
    .modal-backdrop.open{display:flex;align-items:center;justify-content:center}
    .modal{width:min(1000px,100%);max-height:90vh;background:#fff;border-radius:18px;overflow:hidden;display:flex;flex-direction:column;box-shadow:0 25px 80px rgba(0,0,0,.25)}
    .modal-head{padding:18px 22px;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid var(--border)}
    .modal-title{font-weight:800;font-size:17px;max-width:85%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
    .close-btn{width:40px;height:40px;border-radius:10px;border:2px solid var(--border);background:#fff;cursor:pointer;font-size:18px;transition:all .15s}
    .close-btn:hover{border-color:var(--accent);color:var(--accent)}
    .modal-body{display:grid;grid-template-columns:1fr 1fr;gap:18px;padding:18px 22px;overflow-y:auto;flex:1}
    @media(max-width:800px){.modal-body{grid-template-columns:1fr}}
    
    /* Modal Gallery */
    .gallery{border:1px solid var(--border);border-radius:14px;overflow:hidden;background:#f9f9f9}
    .gallery-carousel{position:relative;width:100%;aspect-ratio:3/4;overflow:hidden;background:#f3f4f6}
    .gallery-carousel-inner{display:flex;height:100%;transition:transform .3s ease}
    .gallery-carousel-slide{min-width:100%;height:100%}
    .gallery-carousel-slide img{width:100%;height:100%;object-fit:cover}
    .gallery-nav{position:absolute;top:50%;transform:translateY(-50%);width:40px;height:40px;background:rgba(255,255,255,.95);border:none;border-radius:50%;cursor:pointer;font-size:18px;font-weight:bold;display:flex;align-items:center;justify-content:center;box-shadow:0 2px 10px rgba(0,0,0,.15);color:#333}
    .gallery-prev{right:12px}
    .gallery-next{left:12px}
    .gallery-dots{display:flex;gap:6px;justify-content:center;padding:12px}
    .gallery-dot{width:9px;height:9px;border-radius:50%;background:#ddd;cursor:pointer;border:none;transition:background .15s}
    .gallery-dot.active{background:var(--accent)}
    .gallery-thumbs{display:flex;gap:8px;padding:10px;overflow-x:auto}
    .gallery-thumb{width:55px;height:70px;border-radius:8px;overflow:hidden;cursor:pointer;border:2px solid transparent;flex-shrink:0;background:#f3f4f6;transition:border-color .15s}
    .gallery-thumb.active{border-color:var(--accent)}
    .gallery-thumb img{width:100%;height:100%;object-fit:cover}
    
    .details{border:1px solid var(--border);border-radius:14px;padding:18px;display:flex;flex-direction:column;gap:14px}
    .kpi{display:flex;gap:8px;flex-wrap:wrap}
    .kpi span{border:2px solid var(--border);padding:9px 14px;border-radius:8px;font-weight:700;font-size:13px;color:var(--muted)}
    .kpi span.sale-kpi{border-color:var(--sale-color);color:var(--sale-color);background:rgba(239,68,68,.05)}
    .kpi span.shipping-kpi{border-color:var(--accent-light);color:var(--accent)}
    .kpi span.shipping-kpi.free{border-color:#16a34a;color:#16a34a;background:#dcfce7}
    .modal-colors-section{margin-top:4px}
    .modal-colors{display:flex;gap:10px;flex-wrap:wrap;margin-top:8px}
    .modal-color{width:36px;height:36px;border-radius:50%;border:3px solid #ddd;cursor:pointer;transition:transform .15s;box-shadow:0 2px 6px rgba(0,0,0,.12)}
    .modal-color:hover{transform:scale(1.1)}
    .desc{color:#555;font-size:13px;line-height:1.7;white-space:pre-line}
    .desc-title{font-weight:700;font-size:14px;margin-bottom:8px;color:var(--text)}
    .label{font-size:12px;color:var(--muted);margin-bottom:8px;font-weight:700;text-transform:uppercase}
    .buy-big{margin-top:auto}
    .buy-big a{display:block;text-align:center;padding:14px;border-radius:12px;font-weight:800;background:var(--accent);color:#fff;font-size:15px;transition:all .2s}
    .buy-big a:hover{background:var(--accent-dark)}
    
    /* Footer */
    footer{background:#3a3a3a;color:#fff;margin-top:40px}
    .footer-inner{max-width:var(--container);margin:0 auto;padding:40px 24px;display:grid;grid-template-columns:2fr 1fr 1fr 1fr;gap:40px}
    @media(max-width:900px){.footer-inner{grid-template-columns:1fr 1fr;gap:30px}}
    @media(max-width:500px){.footer-inner{grid-template-columns:1fr}}
    .footer-section h4{font-size:14px;font-weight:700;margin:0 0 16px;color:var(--accent-light)}
    .footer-section a{display:block;color:rgba(255,255,255,.7);font-size:13px;text-decoration:none;margin-bottom:10px;transition:color .15s}
    .footer-section a:hover{color:#fff}
    .footer-brand{font-weight:900;font-size:24px;margin-bottom:12px}
    .footer-desc{font-size:13px;color:rgba(255,255,255,.6);line-height:1.6;margin:0}
    .footer-bottom{border-top:1px solid rgba(255,255,255,.1);text-align:center;padding:20px 24px;font-size:12px;color:rgba(255,255,255,.5)}
    
    /* WhatsApp Button */
    .whatsapp-btn{position:fixed;bottom:24px;right:24px;width:56px;height:56px;background:#c48cb3;border-radius:50%;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 20px rgba(196,140,179,.4);z-index:150;transition:transform .2s,box-shadow .2s}
    .whatsapp-btn:hover{transform:scale(1.1);box-shadow:0 6px 30px rgba(196,140,179,.5)}
    .whatsapp-btn svg{width:28px;height:28px;color:#fff}
    
    /* Load more button */
    #loadMoreBtn{margin:24px auto;display:block;max-width:220px;padding:14px 28px;background:var(--accent);color:#fff;border:none;border-radius:10px;font-weight:700;font-size:14px;cursor:pointer;transition:background .2s}
    #loadMoreBtn:hover{background:var(--accent-dark)}
  </style>
</head>
<body>
  <!-- HEADER -->
  <header class="header">
    <div class="header-top">
      <a href="/" class="logo">
        <img src="/lookli-logo.png" alt="LOOKLI" onerror="this.style.display='none'"/>
      </a>
      <nav class="header-nav">
        <a href="/">×“×£ ×”×‘×™×ª</a>
        <a href="/about.html">××•×“×•×ª</a>
        <a href="/contact.html">×¦×•×¨ ×§×©×¨</a>
      </nav>
      <button class="mobile-menu-btn" onclick="toggleMobileFilters()">â˜°</button>
    </div>
    <div class="search-section">
      <div class="search-inner">
        <div class="searchbar">
          <input id="q" placeholder='×—×¤×©×™: "×©××œ×” ×©×—×•×¨×” ××™×“×” M ×¢×“ 200 ×©"×—"'/>
          <button class="btn" onclick="runAISearch()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
          </button>
        </div>
      </div>
    </div>
  </header>
  
  <!-- Active Filters Bar -->
  <div class="active-filters-bar" id="activeFiltersBar">
    <div class="active-filters-inner">
      <span class="active-filters-label">×¡×™× ×•×Ÿ ×¤×¢×™×œ:</span>
      <div class="active-filters-tags" id="activeFiltersTags"></div>
      <button class="clear-all-btn" onclick="resetAll()">× ×§×” ×”×›×œ</button>
    </div>
  </div>
  
  <div class="ai-analysis" id="aiAnalysis"><div class="ai-box"><div class="ai-icon">ğŸ¤–</div><span id="aiBox"></span></div></div>
  
  <!-- Mobile Filter Button -->
  <button class="mobile-filter-btn" onclick="toggleMobileFilters()">â˜°</button>
  <div class="mobile-overlay" id="mobileOverlay" onclick="toggleMobileFilters()"></div>
  
  <div class="wrap">
    <!-- SIDEBAR -->
    <aside class="filters" id="filtersPanel">
      <button class="filter-close-btn" onclick="toggleMobileFilters()">âœ•</button>
      
      <div class="filter-section open" id="storeSection">
        <div class="filter-header" onclick="toggleFilter('storeSection')">
          <span>×—× ×•×ª</span>
          <span class="arrow">â–²</span>
        </div>
        <div class="filter-content">
          <div class="store-opts" id="storeLogos"></div>
        </div>
      </div>
      
      <div class="filter-section open" id="categorySection">
        <div class="filter-header" onclick="toggleFilter('categorySection')">
          <span>×¡×•×’ ××•×¦×¨</span>
          <span class="arrow">â–²</span>
        </div>
        <div class="filter-content">
          <div class="filter-options" id="categoryBoxes"></div>
        </div>
      </div>
      
      <div class="filter-section" id="colorSection">
        <div class="filter-header" onclick="toggleFilter('colorSection')">
          <span>×¦×‘×¢</span>
          <span class="arrow">â–¼</span>
        </div>
        <div class="filter-content">
          <div class="color-opts" id="colorGrid"></div>
        </div>
      </div>
      
      <div class="filter-section" id="sizeSection">
        <div class="filter-header" onclick="toggleFilter('sizeSection')">
          <span>××™×“×”</span>
          <span class="arrow">â–¼</span>
        </div>
        <div class="filter-content">
          <div class="size-opts" id="sizeBoxes"></div>
        </div>
      </div>
      
      <div class="filter-section" id="priceSection">
        <div class="filter-header" onclick="toggleFilter('priceSection')">
          <span>××—×™×¨</span>
          <span class="arrow">â–¼</span>
        </div>
        <div class="filter-content">
          <div class="price-section">
            <div class="price-display">×¢×“ <span id="priceValue">500</span> â‚ª</div>
            <div class="price-slider">
              <input type="range" id="priceRange" min="50" max="500" step="10" value="500" oninput="updatePriceDisplay()">
            </div>
          </div>
        </div>
      </div>
      
      <div class="filter-section" id="styleSection">
        <div class="filter-header" onclick="toggleFilter('styleSection')">
          <span>×¡×’× ×•×Ÿ</span>
          <span class="arrow">â–¼</span>
        </div>
        <div class="filter-content">
          <div class="filter-options" id="styleBoxes"></div>
        </div>
      </div>
      
      <div class="filter-section" id="fitSection">
        <div class="filter-header" onclick="toggleFilter('fitSection')">
          <span>×’×™×–×¨×”</span>
          <span class="arrow">â–¼</span>
        </div>
        <div class="filter-content">
          <div class="filter-options" id="fitBoxes"></div>
        </div>
      </div>
      
      <div class="filter-section" id="fabricSection">
        <div class="filter-header" onclick="toggleFilter('fabricSection')">
          <span>×¡×•×’ ×‘×“</span>
          <span class="arrow">â–¼</span>
        </div>
        <div class="filter-content">
          <div class="filter-options" id="fabricBoxes"></div>
        </div>
      </div>
      
      <div class="filter-section" id="patternSection">
        <div class="filter-header" onclick="toggleFilter('patternSection')">
          <span>×“×•×’××</span>
          <span class="arrow">â–¼</span>
        </div>
        <div class="filter-content">
          <div class="filter-options" id="patternBoxes"></div>
        </div>
      </div>
      
      <div class="filter-section" id="discountSection">
        <div class="filter-header" onclick="toggleFilter('discountSection')">
          <span>×”× ×—×”</span>
          <span class="arrow">â–¼</span>
        </div>
        <div class="filter-content">
          <div class="filter-options" id="discountBoxes"></div>
        </div>
      </div>
      
      <div style="padding:14px 20px">
        <button class="reset-btn" onclick="resetAll()">××™×¤×•×¡ ×”×›×œ</button>
      </div>
      
    </aside>
    
    <!-- MAIN -->
    <main class="main">
      <div class="toolbar">
        <div class="meta" id="metaToolbar">××¦×™×’ ××ª ×›×œ ×”××•×¦×¨×™×</div>
        <select id="sort" onchange="runRegularSearch()" style="padding:8px 12px;border:2px solid var(--border);border-radius:8px;font-size:13px;font-weight:600">
          <option value="new">×—×“×© â†’ ×™×©×Ÿ</option>
          <option value="price_asc">××—×™×¨ â†‘</option>
          <option value="price_desc">××—×™×¨ â†“</option>
        </select>
      </div>
      <div class="grid" id="grid"></div>
    </main>
    
    <!-- ADS AREA -->
    <aside class="ads-sidebar">
      <div class="ad-placeholder">××§×•×<br>×œ×¤×¨×¡×•××ª</div>
    </aside>
  </div>
  
  <!-- MODAL -->
  <div class="modal-backdrop" id="modalBackdrop" onclick="closeModal(event)">
    <div class="modal" onclick="event.stopPropagation()">
      <div class="modal-head">
        <div class="modal-title" id="modalTitle">×¤×¨×˜×™ ××•×¦×¨</div>
        <button class="close-btn" onclick="closeModal()">âœ•</button>
      </div>
      <div class="modal-body">
        <div class="gallery">
          <div class="gallery-carousel" id="modalCarousel">
            <div class="gallery-carousel-inner" id="modalCarouselInner"></div>
            <button class="gallery-nav gallery-prev" onclick="modalCarouselNav(1)">â€¹</button>
            <button class="gallery-nav gallery-next" onclick="modalCarouselNav(-1)">â€º</button>
          </div>
          <div class="gallery-dots" id="modalDots"></div>
          <div class="gallery-thumbs" id="modalThumbs"></div>
        </div>
        <div class="details">
          <div class="kpi" id="modalKpi"></div>
          <div class="modal-colors-section">
            <div class="label">×¦×‘×¢×™× ×–××™× ×™×</div>
            <div class="modal-colors" id="modalColors"></div>
          </div>
          <div>
            <div class="desc-title">×¤×™×¨×•×˜ ×”××•×¦×¨</div>
            <div class="desc" id="modalDesc"></div>
          </div>
          <div class="buy-big"><a id="modalBuy" href="#" target="_blank">ğŸ›’ ×œ×¨×›×™×©×” ×‘××ª×¨</a></div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- WhatsApp Button -->
  <a href="https://wa.me/972500000000?text=×©×œ×•×, ×¤× ×™×ª×™ ×××ª×¨ LOOKLI" target="_blank" class="whatsapp-btn" title="×©×œ×—×• ×œ× ×• ×”×•×“×¢×” ×‘×•×•××˜×¡××¤">
    <svg viewBox="0 0 24 24" fill="currentColor"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
  </a>
  
  <footer>
    <div class="footer-inner">
      <div class="footer-section">
        <div class="footer-brand">LOOKLI</div>
        <p class="footer-desc">×× ×•×¢ ×”×—×™×¤×•×© ×”×—×›× ×œ××•×¤× ×” ×¦× ×•×¢×”.<br>××•×¦××™× ××ª ×”×œ×•×§ ×©×œ×š ×‘××§×•× ××—×“.</p>
      </div>
      <div class="footer-section">
        <h4>× ×™×•×•×˜ ××”×™×¨</h4>
        <a href="/">×“×£ ×”×‘×™×ª</a>
        <a href="/about.html">××•×“×•×ª</a>
        <a href="/contact.html">×¦×•×¨ ×§×©×¨</a>
      </div>
      <div class="footer-section">
        <h4>×œ×—× ×•×™×•×ª</h4>
        <a href="/contact.html?type=store">×”×¦×˜×¨×¤×•×ª ×œ××ª×¨</a>
        <a href="/contact.html?type=update">×¢×“×›×•×Ÿ ×¤×¨×˜×™×</a>
      </div>
      <div class="footer-section">
        <h4>×¢×–×¨×”</h4>
        <a href="/contact.html?type=bug">×“×™×•×•×— ×¢×œ ×‘×¢×™×”</a>
        <a href="/about.html#faq">×©××œ×•×ª × ×¤×•×¦×•×ª</a>
      </div>
    </div>
    <div class="footer-bottom">
      <span>Â© 2025 LOOKLI - ×›×œ ×”×–×›×•×™×•×ª ×©××•×¨×•×ª</span>
    </div>
  </footer>

<script>
let activeStyle="",activeFit="",activeStore="",activeColor="",activeCategory="",activeDiscount="",activeFabric="",activePattern="",activeSize="";
let debounceTimer=null,modalImages=[],modalImageIndex=0,previousSearchQuery="";
let currentPage=1,itemsPerPage=20,allProducts=[],isLoading=false;
let lastSearchKeywords=[];
let dbCategories=[],dbStyles=[],dbFits=[],dbColors=[],dbSizes=[];

const storeLogos={
  'MEKIMI':'https://mekimi.co.il/wp-content/webp-express/webp-images/uploads/2022/10/logo.png.webp',
  'LICHI':'https://lichi-shop.com/wp-content/uploads/2022/03/cropped-Bold-Feminine-Minimalist-Modern-Pink-Logo.png'
};

const colorData={
  '×©×—×•×¨':'#000000','×œ×‘×Ÿ':'#FFFFFF','×©×× ×ª':'#FFFDD0','×›×—×•×œ':'#2563EB','×ª×›×œ×ª':'#38BDF8',
  '× ×™×™×‘×™':'#1E3A5F','××“×•×':'#DC2626','×‘×•×¨×“×•':'#800020','×™×¨×•×§':'#16A34A','×–×™×ª':'#556B2F',
  '×—××§×™':'#8B8B00','×—×•×':'#92400E','×§×××œ':'#C19A6B','×‘×–×³':'#D4B896','× ×™×•×“':'#E8BEAC',
  '××¤×•×¨':'#6B7280','×•×¨×•×“':'#EC4899','×¡×’×•×œ':'#7C3AED','×œ×™×œ×š':'#C8A2C8','×¦×”×•×‘':'#FACC15',
  '×—×¨×“×œ':'#FFDB58','×›×ª×•×':'#EA580C','×–×”×‘':'#D4AF37','×›×¡×£':'#C0C0C0'
};

function getColorHex(n){if(!n)return'#CCC';const t=n.trim();return colorData[t]||Object.entries(colorData).find(([k])=>t.includes(k)||k.includes(t))?.[1]||'#CCC'}
function formatSize(s){return s?s.replace(/^EU_/i,''):s}
function escapeHtml(s){return String(s??"").replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m]))}
function calcDiscount(p,o){return(!o||o<=p)?0:Math.round((o-p)/o*100)}
function debouncedSearch(){clearTimeout(debounceTimer);debounceTimer=setTimeout(runRegularSearch,250)}
function setLoading(){document.getElementById("grid").innerHTML='<div class="card"><div class="img-wrap"></div><div class="card-body"><div style="height:16px;background:#f3f4f6;border-radius:8px;width:80%"></div></div></div>'.repeat(8)}

function toggleMobileFilters(){
  const filters=document.getElementById('filtersPanel');
  const overlay=document.getElementById('mobileOverlay');
  filters.classList.toggle('open');
  overlay.classList.toggle('show');
  document.body.style.overflow=filters.classList.contains('open')?'hidden':'';
}

function toggleFilter(id){
  const section=document.getElementById(id);
  section.classList.toggle('open');
  const arrow=section.querySelector('.arrow');
  arrow.textContent=section.classList.contains('open')?'â–²':'â–¼';
}

function handleSearchInput(){
  const q=document.getElementById("q").value.trim();
  if(q===""&&previousSearchQuery!==""){
    document.getElementById("aiAnalysis").classList.remove("active");
    resetAllFiltersQuietly();
    lastSearchKeywords=[];
    runRegularSearch();
  }
  previousSearchQuery=q;
}

async function runAISearch(){
  const q=document.getElementById("q").value.trim();
  if(!q){document.getElementById("aiAnalysis").classList.remove("active");lastSearchKeywords=[];runRegularSearch();return}
  setLoading();
  try{
    const res=await fetch("/api/ai-search",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:q})});
    const data=await res.json();
    lastSearchKeywords=data.analysis.keywords||[];
    let parts=[];
    if(data.analysis.keywords?.length)parts.push(data.analysis.keywords.join(' '));
    if(data.analysis.category)parts.push(data.analysis.category);
    if(data.analysis.color)parts.push(data.analysis.color);
    if(data.analysis.size)parts.push(formatSize(data.analysis.size));
    if(data.analysis.maxPrice)parts.push(`×¢×“ â‚ª${data.analysis.maxPrice}`);
    document.getElementById("aiBox").innerHTML=`<strong>×”×‘× ×ª×™:</strong> ${parts.join(' â€¢ ')||'××¦×™×’ ×”×›×œ'}`;
    document.getElementById("aiAnalysis").classList.add("active");
    if(data.analysis.color){activeColor=data.analysis.color;updateColorSelection()}
    if(data.analysis.category){activeCategory=data.analysis.category;updateCategorySelection()}
    if(data.analysis.size){activeSize=data.analysis.size;updateSizeSelection()}
    if(data.analysis.maxPrice){document.getElementById("priceRange").value=Math.min(data.analysis.maxPrice,500);document.getElementById("priceValue").textContent=Math.min(data.analysis.maxPrice,500)}
    allProducts=data.results;currentPage=1;renderPage();
    document.getElementById("metaToolbar").textContent=`${data.count} ×ª×•×¦××•×ª`;
    previousSearchQuery=q;
  }catch(e){console.error(e);alert("×©×’×™××” ×‘×—×™×¤×•×©")}
}

async function runRegularSearch(){
  setLoading();document.getElementById("aiAnalysis").classList.remove("active");
  const params=new URLSearchParams();
  if(lastSearchKeywords.length>0)params.set("q",lastSearchKeywords.join(' '));
  if(activeStore)params.set("store",activeStore);
  if(activeCategory)params.set("category",activeCategory);
  if(activeSize)params.set("size",activeSize);
  if(activeColor)params.set("color",activeColor);
  if(activeStyle)params.set("style",activeStyle);
  if(activeFit)params.set("fit",activeFit);
  if(activeFabric)params.set("fabric",activeFabric);
  if(activePattern)params.set("pattern",activePattern);
  if(activeDiscount)params.set("minDiscount",activeDiscount);
  const maxPrice=document.getElementById("priceRange").value;
  const sliderMax=document.getElementById("priceRange").max;
  if(maxPrice&&parseInt(maxPrice)<parseInt(sliderMax))params.set("maxPrice",maxPrice);
  if(document.getElementById("sort").value)params.set("sort",document.getElementById("sort").value);
  const res=await fetch("/api/products?"+params);
  const data=await res.json();
  allProducts=data;currentPage=1;renderPage();
  document.getElementById("metaToolbar").textContent=`${data.length} ××•×¦×¨×™×`;
}

function renderPage(){
  const end=currentPage*itemsPerPage;
  const productsToShow=allProducts.slice(0,end);
  renderProducts(productsToShow,false);
  updateLoadMoreButton();
}

function loadMore(){
  if(isLoading)return;
  currentPage++;
  const start=(currentPage-1)*itemsPerPage;
  const end=currentPage*itemsPerPage;
  const newProducts=allProducts.slice(start,end);
  renderProducts(newProducts,true);
  updateLoadMoreButton();
}

function updateLoadMoreButton(){
  let btn=document.getElementById("loadMoreBtn");
  const totalPages=Math.ceil(allProducts.length/itemsPerPage);
  if(allProducts.length===0||currentPage>=totalPages||allProducts.length<=itemsPerPage){
    if(btn)btn.style.display='none';
  }else{
    if(!btn){btn=document.createElement('button');btn.id='loadMoreBtn';btn.onclick=loadMore;document.getElementById("grid").after(btn)}
    btn.style.display='block';
    btn.textContent='×˜×¢×Ÿ ×¢×•×“';
  }
}

// Infinite scroll - ×˜×¢×™× ×” ××•×˜×•××˜×™×ª ×‘×’×œ×™×œ×”
window.addEventListener('scroll',()=>{
  if(isLoading)return;
  const totalPages=Math.ceil(allProducts.length/itemsPerPage);
  if(currentPage>=totalPages)return;
  const scrollTop=window.scrollY;
  const windowHeight=window.innerHeight;
  const docHeight=document.documentElement.scrollHeight;
  if(scrollTop+windowHeight>=docHeight-300){
    loadMore();
  }
});

function renderProducts(products,append=false){
  const grid=document.getElementById("grid");
  if(!append)grid.innerHTML="";
  if(!products?.length&&!append){grid.innerHTML='<div class="empty">×œ× × ××¦××• ×ª×•×¦××•×ª</div>';return}
  
  for(const p of products){
    const store=p.store||"MEKIMI",logo=storeLogos[store]||'';
    const images=(p.images?.length)?p.images:(p.image_url?[p.image_url]:[]);
    const colors=p.colors||(p.color?[p.color]:[]);
    const sizes=(p.sizes||[]).map(formatSize);
    const originalPrice=parseFloat(p.original_price)||0;
    const currentPrice=parseFloat(p.price)||0;
    const isOnSale=originalPrice>0&&originalPrice>currentPrice;
    const disc=calcDiscount(currentPrice,originalPrice);
    
    let carouselHTML='';
    if(images.length>1){
      const slides=images.slice(0,6).map(img=>`<div class="carousel-slide"><img src="${escapeHtml(img)}" alt="" loading="lazy"></div>`).join('');
      const dots=images.slice(0,6).map((_,i)=>`<span class="carousel-dot${i===0?' active':''}" onclick="event.stopPropagation();goToSlide(this,${i})"></span>`).join('');
      carouselHTML=`<div class="carousel" data-index="0"><div class="carousel-inner">${slides}</div><div class="carousel-dots">${dots}</div><button class="carousel-nav carousel-prev" onclick="event.stopPropagation();carouselNav(this,-1)">â€¹</button><button class="carousel-nav carousel-next" onclick="event.stopPropagation();carouselNav(this,1)">â€º</button></div>`;
    }else if(images.length===1){
      carouselHTML=`<img src="${escapeHtml(images[0])}" alt="" style="width:100%;height:100%;object-fit:cover" loading="lazy">`;
    }else{carouselHTML=`<div style="display:flex;align-items:center;justify-content:center;height:100%;color:#ccc;font-size:12px">××™×Ÿ ×ª××•× ×”</div>`}
    
    let colorDotsHTML='';
    if(colors.length>0){
      colorDotsHTML='<div class="card-colors">';
      colors.slice(0,3).forEach(c=>{colorDotsHTML+=`<span class="card-color" style="background:${getColorHex(c)}" title="${escapeHtml(c)}"></span>`});
      if(colors.length>3)colorDotsHTML+=`<span class="card-color-more">+${colors.length-3}</span>`;
      colorDotsHTML+='</div>';
    }
    
    const saleBadgeHTML=isOnSale?`<div class="sale-badge">${disc}%-</div>`:'';
    const priceHTML=isOnSale?`<div class="price-wrap"><div class="price sale">â‚ª${currentPrice}</div><div class="price-original">â‚ª${originalPrice}</div></div>`:`<div class="price">${currentPrice?'â‚ª'+currentPrice:''}</div>`;
    
    let shippingBadgeHTML='';
    if(p.shipping){
      if(p.shipping.isFree){shippingBadgeHTML=`<span class="shipping-badge free">××©×œ×•×— ×—×™× ×</span>`}
      else{shippingBadgeHTML=`<span class="shipping-badge">××©×œ×•×— â‚ª${p.shipping.cost}</span>`}
    }
    
    grid.innerHTML+=`<div class="card" onclick="openProduct(${p.id})"><div class="img-wrap">${saleBadgeHTML}${carouselHTML}${logo?`<div class="card-logo"><img src="${logo}" alt="${store}"></div>`:''}${colorDotsHTML}</div><div class="card-body"><div class="title">${escapeHtml(p.title||'')}</div><div class="subrow">${priceHTML}<div class="store">${escapeHtml(store)}</div></div><div class="card-footer"><div class="sizes">${sizes.slice(0,4).join(', ')||'-'}</div>${shippingBadgeHTML}</div></div></div>`;
  }
}

function carouselNav(btn,dir){
  const carousel=btn.closest('.carousel'),inner=carousel.querySelector('.carousel-inner'),slides=carousel.querySelectorAll('.carousel-slide'),dots=carousel.querySelectorAll('.carousel-dot');
  let idx=parseInt(carousel.dataset.index)||0;idx+=dir;if(idx<0)idx=slides.length-1;if(idx>=slides.length)idx=0;
  carousel.dataset.index=idx;inner.style.transform=`translateX(${idx*100}%)`;dots.forEach((d,i)=>d.classList.toggle('active',i===idx));
}
function goToSlide(dot,idx){
  const carousel=dot.closest('.carousel'),inner=carousel.querySelector('.carousel-inner'),dots=carousel.querySelectorAll('.carousel-dot');
  carousel.dataset.index=idx;inner.style.transform=`translateX(${idx*100}%)`;dots.forEach((d,i)=>d.classList.toggle('active',i===idx));
}
function modalCarouselNav(dir){modalImageIndex+=dir;if(modalImageIndex<0)modalImageIndex=modalImages.length-1;if(modalImageIndex>=modalImages.length)modalImageIndex=0;updateModalCarousel()}
function goToModalSlide(idx){modalImageIndex=idx;updateModalCarousel()}
function updateModalCarousel(){
  document.getElementById("modalCarouselInner").style.transform=`translateX(${modalImageIndex*100}%)`;
  document.querySelectorAll('.gallery-dot').forEach((d,i)=>d.classList.toggle('active',i===modalImageIndex));
  document.querySelectorAll('.gallery-thumb').forEach((t,i)=>t.classList.toggle('active',i===modalImageIndex));
}

const allFabrics=['×¡×¨×™×’','××¨×™×’','×’\'×¨×¡×™','×¤×™×§×”','×©×™×¤×•×Ÿ','×§×¨×¤','×¡××˜×Ÿ','×§×˜×™×¤×”','×¤×œ×™×–','×ª×—×¨×”','×˜×•×œ','×œ×™×™×§×¨×”','×˜×¨×™×§×•','×¨×©×ª','×’\'×™× ×¡','×§×•×¨×“×¨×•×™'];
const allPatterns=['×¤×¡×™×','×¤×¨×—×•× ×™','××©×‘×¦×•×ª','× ×§×•×“×•×ª','×—×œ×§','×”×“×¤×¡','××‘×¡×˜×¨×§×˜×™','×’×™××•××˜×¨×™','×—×™×•×ª'];
const allDiscounts=[{val:'20',label:'20%+'},{val:'40',label:'40%+'},{val:'60',label:'60%+'}];

async function initFilters(){
  const data=await(await fetch("/api/filters")).json();
  dbCategories=data.categories||[];dbStyles=data.styles||[];dbFits=data.fits||[];dbColors=data.colors||[];dbSizes=data.sizes||[];
  
  const storeDiv=document.getElementById("storeLogos");
  storeDiv.innerHTML=`<div class="store-opt active" data-store="" onclick="selectStore('')"><span>×”×›×œ</span></div>`;
  (data.stores||[]).forEach(s=>{const logo=storeLogos[s];storeDiv.innerHTML+=`<div class="store-opt" data-store="${s}" onclick="selectStore('${s}')">${logo?`<img src="${logo}" alt="${s}">`:`<span>${s.substring(0,3)}</span>`}</div>`});
  
  renderCategoryBoxes();renderColorGrid();renderSizeBoxes();renderStyleBoxes();renderFitBoxes();renderFabricBoxes();renderPatternBoxes();
  
  const discDiv=document.getElementById("discountBoxes");
  discDiv.innerHTML=`<div class="filter-opt${activeDiscount===''?' active':''}" data-discount="" onclick="selectDiscount('')">×”×›×œ</div>`+allDiscounts.map(d=>`<div class="filter-opt" data-discount="${d.val}" onclick="selectDiscount('${d.val}')">${d.label}</div>`).join('');
  
  if(data.maxPrice){const slider=document.getElementById("priceRange");const roundedMax=Math.ceil(data.maxPrice/10)*10;slider.max=roundedMax;slider.value=roundedMax;document.getElementById("priceValue").textContent=roundedMax}
}

function renderCategoryBoxes(){const div=document.getElementById("categoryBoxes");div.innerHTML=`<div class="filter-opt${activeCategory===''?' active':''}" data-cat="" onclick="selectCategory('')">×”×›×œ</div>`+dbCategories.map(c=>`<div class="filter-opt${activeCategory===c?' active':''}" data-cat="${escapeHtml(c)}" onclick="selectCategory('${escapeHtml(c)}')">${escapeHtml(c)}</div>`).join('')}
function renderColorGrid(){const div=document.getElementById("colorGrid");div.innerHTML=`<div class="color-opt${activeColor===''?' active':''}" data-color="" style="background:linear-gradient(135deg,#f00,#0f0,#00f,#ff0)" title="×”×›×œ" onclick="selectColor('')"></div>`+dbColors.map(c=>`<div class="color-opt${activeColor===c?' active':''}" data-color="${escapeHtml(c)}" style="background:${getColorHex(c)}" title="${escapeHtml(c)}" onclick="selectColor('${escapeHtml(c)}')"></div>`).join('')}
function renderSizeBoxes(){const div=document.getElementById("sizeBoxes");div.innerHTML=`<div class="size-opt${activeSize===''?' active':''}" data-size="" onclick="selectSize('')">×”×›×œ</div>`+dbSizes.map(s=>`<div class="size-opt${activeSize===s?' active':''}" data-size="${escapeHtml(s)}" onclick="selectSize('${escapeHtml(s)}')">${formatSize(s)}</div>`).join('')}
function renderStyleBoxes(){const div=document.getElementById("styleBoxes");if(dbStyles.length===0){document.getElementById("styleSection").style.display='none';return}document.getElementById("styleSection").style.display='block';div.innerHTML=`<div class="filter-opt${activeStyle===''?' active':''}" data-style="" onclick="selectStyle('')">×”×›×œ</div>`+dbStyles.map(s=>`<div class="filter-opt${activeStyle===s?' active':''}" data-style="${escapeHtml(s)}" onclick="selectStyle('${escapeHtml(s)}')">${escapeHtml(s)}</div>`).join('')}
function renderFitBoxes(){const div=document.getElementById("fitBoxes");if(dbFits.length===0){document.getElementById("fitSection").style.display='none';return}document.getElementById("fitSection").style.display='block';div.innerHTML=`<div class="filter-opt${activeFit===''?' active':''}" data-fit="" onclick="selectFit('')">×”×›×œ</div>`+dbFits.map(f=>`<div class="filter-opt${activeFit===f?' active':''}" data-fit="${escapeHtml(f)}" onclick="selectFit('${escapeHtml(f)}')">${escapeHtml(f)}</div>`).join('')}
function renderFabricBoxes(){const div=document.getElementById("fabricBoxes");div.innerHTML=`<div class="filter-opt${activeFabric===''?' active':''}" data-fabric="" onclick="selectFabric('')">×”×›×œ</div>`+allFabrics.map(f=>`<div class="filter-opt${activeFabric===f?' active':''}" data-fabric="${escapeHtml(f)}" onclick="selectFabric('${escapeHtml(f)}')">${escapeHtml(f)}</div>`).join('')}
function renderPatternBoxes(){const div=document.getElementById("patternBoxes");div.innerHTML=`<div class="filter-opt${activePattern===''?' active':''}" data-pattern="" onclick="selectPattern('')">×”×›×œ</div>`+allPatterns.map(p=>`<div class="filter-opt${activePattern===p?' active':''}" data-pattern="${escapeHtml(p)}" onclick="selectPattern('${escapeHtml(p)}')">${escapeHtml(p)}</div>`).join('')}

function updateActiveFiltersBar(){
  const tags=[];
  if(activeStore)tags.push({type:'store',label:`×—× ×•×ª: ${activeStore}`,value:activeStore});
  if(activeCategory)tags.push({type:'category',label:activeCategory,value:activeCategory});
  if(activeColor)tags.push({type:'color',label:`×¦×‘×¢: ${activeColor}`,value:activeColor});
  if(activeSize)tags.push({type:'size',label:`××™×“×”: ${formatSize(activeSize)}`,value:activeSize});
  if(activeStyle)tags.push({type:'style',label:`×¡×’× ×•×Ÿ: ${activeStyle}`,value:activeStyle});
  if(activeFit)tags.push({type:'fit',label:`×’×™×–×¨×”: ${activeFit}`,value:activeFit});
  if(activeFabric)tags.push({type:'fabric',label:`×‘×“: ${activeFabric}`,value:activeFabric});
  if(activePattern)tags.push({type:'pattern',label:`×“×•×’××: ${activePattern}`,value:activePattern});
  if(activeDiscount)tags.push({type:'discount',label:`${activeDiscount}%+ ×”× ×—×”`,value:activeDiscount});
  
  const bar=document.getElementById("activeFiltersBar");
  const tagsDiv=document.getElementById("activeFiltersTags");
  
  if(tags.length===0){
    bar.classList.remove('show');
  }else{
    bar.classList.add('show');
    tagsDiv.innerHTML=tags.map(t=>`<span class="filter-tag">${escapeHtml(t.label)}<span class="remove-tag" onclick="removeFilter('${t.type}')">âœ•</span></span>`).join('');
  }
}

function removeFilter(type){
  switch(type){
    case'store':activeStore="";document.querySelectorAll('.store-opt').forEach(el=>el.classList.toggle('active',el.dataset.store===''));break;
    case'category':activeCategory="";updateCategorySelection();break;
    case'color':activeColor="";updateColorSelection();break;
    case'size':activeSize="";updateSizeSelection();break;
    case'style':activeStyle="";document.querySelectorAll('#styleBoxes .filter-opt').forEach(el=>el.classList.toggle('active',el.dataset.style===''));break;
    case'fit':activeFit="";document.querySelectorAll('#fitBoxes .filter-opt').forEach(el=>el.classList.toggle('active',el.dataset.fit===''));break;
    case'fabric':activeFabric="";document.querySelectorAll('#fabricBoxes .filter-opt').forEach(el=>el.classList.toggle('active',el.dataset.fabric===''));break;
    case'pattern':activePattern="";document.querySelectorAll('#patternBoxes .filter-opt').forEach(el=>el.classList.toggle('active',el.dataset.pattern===''));break;
    case'discount':activeDiscount="";document.querySelectorAll('#discountBoxes .filter-opt').forEach(el=>el.classList.toggle('active',el.dataset.discount===''));break;
  }
  runRegularSearch();
}

function updateColorSelection(){document.querySelectorAll('.color-opt').forEach(el=>el.classList.toggle('active',el.dataset.color===activeColor));updateActiveFiltersBar()}
function updateCategorySelection(){document.querySelectorAll('#categoryBoxes .filter-opt').forEach(el=>el.classList.toggle('active',el.dataset.cat===activeCategory));updateActiveFiltersBar()}
function updateSizeSelection(){document.querySelectorAll('.size-opt').forEach(el=>el.classList.toggle('active',el.dataset.size===activeSize));updateActiveFiltersBar()}
function updatePriceDisplay(){const val=document.getElementById("priceRange").value;document.getElementById("priceValue").textContent=val;debouncedSearch()}

function selectStore(s){activeStore=(activeStore===s&&s!=="")?"":s;document.querySelectorAll('.store-opt').forEach(el=>el.classList.toggle('active',el.dataset.store===activeStore));updateActiveFiltersBar();runRegularSearch()}
function selectCategory(c){activeCategory=(activeCategory===c)?"":c;updateCategorySelection();runRegularSearch()}
function selectColor(c){activeColor=(activeColor===c)?"":c;updateColorSelection();runRegularSearch()}
function selectSize(s){activeSize=(activeSize===s)?"":s;updateSizeSelection();runRegularSearch()}
function selectStyle(s){activeStyle=(activeStyle===s)?"":s;document.querySelectorAll('#styleBoxes .filter-opt').forEach(el=>el.classList.toggle('active',el.dataset.style===activeStyle));updateActiveFiltersBar();runRegularSearch()}
function selectFit(f){activeFit=(activeFit===f)?"":f;document.querySelectorAll('#fitBoxes .filter-opt').forEach(el=>el.classList.toggle('active',el.dataset.fit===activeFit));updateActiveFiltersBar();runRegularSearch()}
function selectFabric(f){activeFabric=(activeFabric===f)?"":f;document.querySelectorAll('#fabricBoxes .filter-opt').forEach(el=>el.classList.toggle('active',el.dataset.fabric===activeFabric));updateActiveFiltersBar();runRegularSearch()}
function selectPattern(p){activePattern=(activePattern===p)?"":p;document.querySelectorAll('#patternBoxes .filter-opt').forEach(el=>el.classList.toggle('active',el.dataset.pattern===activePattern));updateActiveFiltersBar();runRegularSearch()}
function selectDiscount(d){activeDiscount=(activeDiscount===d)?"":d;document.querySelectorAll('#discountBoxes .filter-opt').forEach(el=>el.classList.toggle('active',el.dataset.discount===activeDiscount));updateActiveFiltersBar();runRegularSearch()}

function resetAllFiltersQuietly(){
  activeStore="";activeCategory="";activeColor="";activeStyle="";activeFit="";activeDiscount="";activeFabric="";activePattern="";activeSize="";
  const slider=document.getElementById("priceRange");slider.value=slider.max;document.getElementById("priceValue").textContent=slider.max;
  document.querySelectorAll(".store-opt").forEach(el=>el.classList.toggle('active',el.dataset.store===''));
  document.querySelectorAll(".filter-opt").forEach(el=>el.classList.toggle('active',el.dataset.cat===''||el.dataset.style===''||el.dataset.fit===''||el.dataset.fabric===''||el.dataset.pattern===''||el.dataset.discount===''));
  document.querySelectorAll(".color-opt").forEach(el=>el.classList.toggle('active',el.dataset.color===''));
  document.querySelectorAll(".size-opt").forEach(el=>el.classList.toggle('active',el.dataset.size===''));
  document.getElementById("activeFiltersBar").classList.remove('show');
}

function resetAll(){document.getElementById("q").value="";previousSearchQuery="";lastSearchKeywords=[];resetAllFiltersQuietly();document.getElementById("aiAnalysis").classList.remove("active");runRegularSearch()}

async function openProduct(id){
  document.getElementById("modalBackdrop").classList.add("open");
  document.getElementById("modalTitle").textContent="×˜×•×¢×Ÿâ€¦";
  document.getElementById("modalDesc").textContent="";
  document.getElementById("modalKpi").innerHTML="";
  document.getElementById("modalColors").innerHTML="";
  document.getElementById("modalThumbs").innerHTML="";
  document.getElementById("modalCarouselInner").innerHTML="";
  document.getElementById("modalDots").innerHTML="";
  try{
    const p=await(await fetch("/api/product/"+id)).json();
    document.getElementById("modalTitle").textContent=p.title||"××•×¦×¨";
    document.getElementById("modalBuy").href=p.source_url||("/out/"+id);
    document.getElementById("modalDesc").textContent=(p.description||"").replace(/\r\n/g,'\n').replace(/\r/g,'\n')||"××™×Ÿ ×ª×™××•×¨ × ×•×¡×£";
    modalImages=(p.images?.length)?p.images:(p.image_url?[p.image_url]:[]);modalImageIndex=0;
    document.getElementById("modalCarouselInner").innerHTML=modalImages.map(img=>`<div class="gallery-carousel-slide"><img src="${escapeHtml(img)}" alt=""></div>`).join('');
    document.getElementById("modalDots").innerHTML=modalImages.map((_,i)=>`<button class="gallery-dot${i===0?' active':''}" onclick="goToModalSlide(${i})"></button>`).join('');
    document.getElementById("modalThumbs").innerHTML=modalImages.map((img,i)=>`<div class="gallery-thumb${i===0?' active':''}" onclick="goToModalSlide(${i})"><img src="${escapeHtml(img)}" loading="lazy"></div>`).join('');
    
    const kpis=[],isOnSale=p.original_price&&p.original_price>p.price,disc=calcDiscount(p.price,p.original_price);
    if(p.store)kpis.push(`<span>×—× ×•×ª: ${escapeHtml(p.store)}</span>`);
    if(isOnSale){kpis.push(`<span class="sale-kpi">â‚ª${p.price} <s>â‚ª${p.original_price}</s> (${disc}%-)</span>`)}else if(p.price){kpis.push(`<span>××—×™×¨: â‚ª${p.price}</span>`)}
    if(p.sizes?.length)kpis.push(`<span>××™×“×•×ª: ${p.sizes.map(formatSize).join(', ')}</span>`);
    if(p.category)kpis.push(`<span>×¡×•×’: ${escapeHtml(p.category)}</span>`);
    if(p.shipping){if(p.shipping.isFree){kpis.push(`<span class="shipping-kpi free">××©×œ×•×— ×—×™× ×</span>`)}else{kpis.push(`<span class="shipping-kpi">××©×œ×•×— â‚ª${p.shipping.cost} (×—×™× × ××¢×œ â‚ª${p.shipping.threshold})</span>`)}}
    document.getElementById("modalKpi").innerHTML=kpis.join("");
    
    const colors=p.colors||(p.color?[p.color]:[]);
    const colorsDiv=document.getElementById("modalColors");
    if(colors.length){colors.forEach(c=>{colorsDiv.innerHTML+=`<span class="modal-color" style="background:${getColorHex(c)}" title="${escapeHtml(c)}"></span>`})}else{colorsDiv.innerHTML='<span style="color:#999;font-size:12px">×œ× ×¦×•×™×Ÿ</span>'}
  }catch(e){document.getElementById("modalTitle").textContent="×©×’×™××” ×‘×˜×¢×™× ×”"}
}

function closeModal(e){if(e&&e.target!==e.currentTarget)return;document.getElementById("modalBackdrop").classList.remove("open")}

document.getElementById("q").addEventListener("input",handleSearchInput);
document.getElementById("q").addEventListener("keypress",e=>{if(e.key==="Enter")runAISearch()});

(async()=>{await initFilters();await runRegularSearch()})();
</script>
</body>
</html>
